<!DOCTYPE html>
{% extends "index.html" %}
{% load static %}

{% block main_contents %}
<div class="container-fluid px-2 my-3">
    <div class="card" style="border: none; background-color: transparent; border-radius: 8px;">
        <div class="card-body px-3 pt-1">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="mb-0" style="color: #274C77; font-weight: 600; font-size: 3.0rem;">Products</h1>
            </div>

    <div class="container my-0 d-flex w-100" style="gap: 20px;"> <!-- Added gap here -->
        <!-- Sidebar Filter (Separate Container) -->
        <div class="card mb-4" style="border: none; border-radius: 8px; width: 250px;"> <!-- Fixed width for consistency -->
            <div class="card-header" style="background-color: #274C77; color: white; border-radius: 8px 8px 0 0;">
                <h5 class="card-title mb-0">
                    <i class="bi bi-filter"></i> Search Filters
                </h5>
            </div>
    
        <div class="filter-container me-3" style="width: 30vh; padding: 15px; min-height: 0vh;">
                    
                    <div class="mb-3">    
                        <label for="category">Category:</label>
                        <select id="category" class="form-control" onchange="applyFilters()">
                            <option value="">All</option>
                            <option value="helmet">Helmet</option>
                            <option value="top box">Top Box</option>
                        </select>   
                    </div>

                    <!-- Price Range -->
                    <div class="mb-3">
                        <label>Price Range:</label>
                        <div class="d-flex align-items-center">
                            <input type="number" id="minPrice" placeholder="₱ MIN" class="form-control me-2" style="width: 90px;" oninput="applyFilters()">
                            <span>—</span>
                            <input type="number" id="maxPrice" placeholder="₱ MAX" class="form-control ms-2" style="width: 90px;" oninput="applyFilters()">
                        </div>
                    </div>

                    <!-- Brand -->
                    <div class="mb-3">
                        <label for="brand">Brand:</label>
                        <input type="text" id="brand" class="form-control" placeholder="Type brand" oninput="applyFilters()">
                    </div>

                    <!-- Color -->
                    <div class="mb-3">
                        <label for="color">Color:</label>
                        <input type="text" id="color" class="form-control" placeholder="Type color" oninput="applyFilters()">
                    </div>

                    <!-- Size -->
                    <div class="mb-3">
                        <label>Size:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Kids" id="sizeKids" onchange="applyFilters()">
                            <label class="form-check-label" for="sizeKids">Kids</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Standard" id="sizeStandard" onchange="applyFilters()">
                            <label class="form-check-label" for="sizeStandard">Standard</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Medium" id="sizeMedium" onchange="applyFilters()">
                            <label class="form-check-label" for="sizeMedium">Medium</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Large" id="sizeLarge" onchange="applyFilters()">
                            <label class="form-check-label" for="sizeLarge">Large</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="X Large" id="sizeXLarge" onchange="applyFilters()">
                            <label class="form-check-label" for="sizeXLarge">X Large</label>
                            
                        </div> 
                        </div>
                     <label>Stocks:</label>   
                     <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="inStock" id="inStock" onchange="applyFilters()">
                            <label class="form-check-label" for="inStock">In Stock</label>   
                    </div>

                </div>

         </div>
        


        
            <!-- Product Catalog -->
    <div class="card mb-4 flex-grow-1" style="border: none; border-radius: 8px;">
        <div class="card-header" style="background-color: #274C77; color: white; border-radius: 8px 8px 0 0;">
            <h5 class="card-title mb-0">Product Catalog</h5>
        </div>
        <div class="card-body p-0 overflow-auto" style="max-height: 550px; border-radius: 0 0 8px 8px;">
            <div class="product-table">
                {% include "productTable.html" with table_id="productTable" %}
            </div>
        </div>
    </div>
</div>
        
        
        
        
    </div>
</div>

<style>
body {
    background: linear-gradient(to right, #d9dde4, #7196b3); /* Subtle gradient */
    height: 100%;
    overflow: hidden;
}

   #productTable {
    width: 100%;
    border-collapse: collapse;
}

.table-container thead {
    position: sticky;
    top: 0;
    background: white;
    z-index: 2;
}

/* Ensure the table expands fully */
.product-table {
    width: 100%;
    overflow-x: auto;
}


/* Fix table header */
.table-container thead {
    position: sticky;
    top: 0;
    background: white;
    z-index: 2;
}

/* Optional: Adjust padding */
th:first-child, td:first-child {
    display: none;
}

table td, table th {
    padding: 15px 10px;
}

.filter-container {
    background-color: #ffffff;
    border-radius: 8px;
    margin-right: 20px;
    flex: 1;
    min-width: 250px;
    max-width: 30%;
    padding: 15px;
}

.container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    overflow: auto;
}

.card.mb-4.flex-grow-1 {
    flex: 2;
    min-width: 60%;
}

.card-body {
    flex-grow: 1;
    max-height: 100vh;
    overflow-y: auto;
}

/* Responsive for smaller screens */
@media (max-width: 768px) {
    .container {
        flex-direction: column;
    }

    .filter-container, .card.mb-4.flex-grow-1 {
        max-width: 100%;
    }
}

/* Style text fields */
.form-control {
    border: 1px solid #000000; 
    border-radius: 6px; /* Rounded corners */
    transition: all 0.3s ease-in-out;
}

.form-control:focus {
    border-color: #000000; /* Darker blue on focus */
}

/* Style checkboxes */
.form-check-input {
    border: 2px solid #000000;
    border-radius: 4px; /* Slight rounding */
}

.form-check-input:checked {
    background-color: #274C77;
    border-color: #1B3A57;
}

.main-content {
    flex-grow: 1;
    max-height: calc(100vh - [header height]); /* Adjust header height accordingly */
    overflow-y: auto;
}

.product-catalog {
    max-height: 60vh; /* Adjust based on layout */
    overflow-y: auto;
}

.main-content > * {
    margin-bottom: 0;
    padding-bottom: 0;
}
</style>

<script>
    function applyFilters() {
    let minPriceInput = document.getElementById("minPrice").value.trim();
    let maxPriceInput = document.getElementById("maxPrice").value.trim();
    let minPrice = minPriceInput !== "" ? parseFloat(minPriceInput) : 0;
    let maxPrice = maxPriceInput !== "" ? parseFloat(maxPriceInput) : Infinity;
    let brand = document.getElementById("brand").value.toLowerCase();
    let color = document.getElementById("color").value.toLowerCase();
    let selectedSizes = Array.from(document.querySelectorAll("input[type='checkbox']:checked"))
        .filter(checkbox => checkbox.id !== 'inStock')
        .map(checkbox => checkbox.value.toLowerCase());
    let inStock = document.getElementById("inStock").checked;
    
    // Get selected category (Helmet or Top Box)
    let category = document.getElementById("category").value.toLowerCase();

    let rows = document.querySelectorAll("#productTable tbody tr");
    rows.forEach(row => {
        let price = parseFloat(row.getAttribute("data-price")) || 0;
        let rowBrand = row.getAttribute("data-brand")?.toLowerCase() || "";
        let rowColor = row.getAttribute("data-color")?.toLowerCase() || "";
        let rowSize = row.getAttribute("data-size")?.toLowerCase() || "";
        let rowInStock = row.getAttribute("data-in-stock")?.toLowerCase() === "true";
        let rowCategory = row.getAttribute("data-type")?.toLowerCase() || "";

        let matchesPrice = (minPrice <= price) && (price <= maxPrice);
        let matchesBrand = !brand || rowBrand.includes(brand);
        let matchesColor = !color || rowColor.includes(color);
        let matchesSize = selectedSizes.length === 0 || selectedSizes.includes(rowSize);
        let matchesInStock = !inStock || rowInStock;
        let matchesCategory = !category || rowCategory === category;

        row.style.display = matchesPrice && matchesBrand && matchesColor && matchesSize && matchesInStock && matchesCategory ? "" : "none";
    });
}
</script>

{% endblock %}